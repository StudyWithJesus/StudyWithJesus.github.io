<!-- Fingerprint Logger Scripts -->
<!-- 
  This include adds fingerprint logging to track unique visitors.
  
  IMPORTANT: This file does NOT contain any secrets or tokens.
  All authentication happens server-side in the Firebase Cloud Function.
  
  Files included:
  1. fingerprint-logger.js - Generates SHA-256 fingerprint and logs to Firebase Cloud Function
  2. whitelist-fingerprint.js - (Optional) Blocks access unless fingerprint is whitelisted
  
  SETUP INSTRUCTIONS:
  
  For Firebase Cloud Functions:
  =============================
  1. Deploy the fingerprint logging function:
     ```
     firebase deploy --only functions:logFingerprint
     ```
  
  2. Set environment variables for the function:
     ```
     firebase functions:config:set github.token="YOUR_GITHUB_TOKEN"
     firebase functions:config:set github.repo="owner/repo"
     ```
     Or set in Firebase Console → Functions → Configuration
     - GITHUB_TOKEN (required): Personal access token with 'repo' scope
       Create at: https://github.com/settings/tokens
     - GITHUB_REPO (optional): Format 'owner/repo', defaults to StudyWithJesus/StudyWithJesus.github.io
  
  3. After setting config, redeploy:
     ```
     firebase deploy --only functions:logFingerprint
     ```
  
  4. The function will be available at:
     https://us-central1-studywithjesus.cloudfunctions.net/logFingerprint
  
  5. Fingerprints will be logged as GitHub issues in your repository
  
  Optional: Use Firebase Hosting Rewrites for Cleaner URLs
  =========================================================
  Add to your firebase.json under "hosting":
  ```json
  "rewrites": [
    {
      "source": "/api/logFingerprint",
      "function": "logFingerprint"
    }
  ]
  ```
  
  Then update assets/fingerprint-logger.js to use:
  const endpoint = '/api/logFingerprint';
  
  Using a Custom Webhook Instead:
  ================================
  To send fingerprints to a different endpoint (e.g., custom webhook):
  
  1. Edit assets/fingerprint-logger.js
  2. Change the endpoint URL to your webhook
  
  3. Your webhook should accept POST requests with JSON payload:
     {
       "fp": "sha256-hash-string",
       "ua": "user-agent-string",
       "lang": "language-code",
       "tz": timezone-offset-minutes,
       "ts": "ISO-timestamp",
       "url": "page-url",
       "name": "optional-display-name"
     }
  
  Blacklist Blocker (Enabled Site-Wide):
  ======================================
  The whitelist-fingerprint.js script blocks specific users.
  
  BEHAVIOR:
  - Everyone has access by default
  - Only blocks fingerprints marked as "BLOCKED" in the admin dashboard
  - Blocked list stored in browser localStorage (automatic sync)
  
  HOW TO USE:
  1. Visit /pages/admin/fingerprint-admin.html
  2. Click "Continue in Local Mode"
  3. Find the fingerprint you want to block
  4. Click the toggle switch to change status to "BLOCKED"
  5. That fingerprint will be blocked across all pages immediately
  
  NOTE: No manual configuration needed - blocking is managed through the admin dashboard
-->

<!-- Firebase SDK for Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Firebase Configuration -->
<script src="/config/firebase.config.js"></script>

<!-- Fingerprint Logger (Always Active) -->
<script src="/assets/fingerprint-logger.js"></script>

<!-- Blacklist Blocker (Enabled site-wide - blocks users toggled in admin dashboard) -->
<script src="/assets/whitelist-fingerprint.js"></script>
